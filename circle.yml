checkout:
  post:
    - wget http://selenium-release.storage.googleapis.com/2.45/selenium-server-standalone-2.45.0.jar -O selenium-server-standalone.jar

dependencies:
  override:
    - sudo service apache2 start
    - >
        echo "CREATE DATABASE drupal;
        GRANT ALL PRIVILEGES ON drupal.* TO 'drupal'@'localhost'
        IDENTIFIED BY 'drupal';
        FLUSH PRIVILEGES;" | mysql -uroot
    - mysql drupal < db/ivan_wedding.sql
    - sudo rm -r /var/www
    - sudo ln -s ~/drupal-docker-marriage/site /var/www
    - sed -e 's/%%PASSWORD%%/drupal/' site/sites/default/default.settings.php deploy/settings.db > site/sites/default/settings.php
    - sudo install -d -o www-data site/sites/default/files

test:
  pre:
    # Run selenium server in background: https://circleci.com/docs/background-process
    - 'java -jar selenium-server-standalone.jar &> selenium.log':
        background: true
  override:
    - curl -v localhost:8080
    - curl -s localhost:8080 | grep RSVP
    - make test
